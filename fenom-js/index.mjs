import{join as e}from"path";import{readFile as t}from"fs/promises";const r=[...[{type:"extends",regex:/^\{extends\s+['"]file:([^'"]+)['"]\s*\}/,process:e=>({file:e[1]})},{type:"block_open",regex:/^\{block\s+(['"])(.*?)\1\s*\}/,process:e=>({name:e[2]})},{type:"block_close",regex:/^\{\/block\}/},{type:"parent",regex:/^\{parent\}/},{type:"paste",regex:/^\{paste\s+(['"])(.*?)\1\}/,process:e=>({name:e[2]})},{type:"use",regex:/^\{use\s+(['"])(.*?)\1\}/,process:e=>({file:e[2]})}],{type:"include",regex:/^\{include\s+['"]file:([^'"]+)['"](?:\s+((?:\s*\w+\s*=\s*(?:"[^"]*"|'[^']*'|[^\s}]+))+))?\s*\}/,process:e=>{const t=e[1],r=e[2],s={};if(r){const e=/(\w+)\s*=\s*(?:"([^"]*)"|'([^']*)'|([^\s}]+))/g;let t;for(;null!==(t=e.exec(r));){const e=t[1],r=t[2]||t[3]||t[4]||"";s[e]=r}}return{file:t,params:s}}},{type:"for",regex:/^\{(for|foreach)\s*\$(\w+(?:\.\w+)?)\s+as\s*\$(\w+)(?:\s*\|\s*reverse)?\s*\}/,process:e=>({collection:`$${e[2]}`,item:e[3],key:null,reverse:e[0].includes("| reverse")})},{type:"for",regex:/^\{(for|foreach)\s*\$(\w+(?:\.\w+)?)\s+as\s*\$(\w+)\s*=>\s*\$(\w+)(?:\s*\|\s*reverse)?\s*\}/,process:e=>({collection:`$${e[2]}`,key:e[3],item:e[4],reverse:e[0].includes("| reverse")})},{type:"endfor",regex:/^\{\/(?:for|foreach)\}/},{type:"break",regex:/^\{break\}/i},{type:"continue",regex:/^\{continue\}/i},...[{type:"switch",regex:/^\{switch\s+(.+?)\}/,process:e=>({value:e[1].trim()})},{type:"case",regex:/^\{case\s+(.+?)\}/,process:e=>({value:e[1].trim()})},{type:"default",regex:/^\{default\}/},{type:"endswitch",regex:/^\{\/switch\}/}],{type:"operator",regex:/^\{\$(\w+)\s*(\+\+|--|\+=|-=|\*=|\/=|\%=)\s*([^}]+)?\}/,process:e=>{var t;return{variable:e[1],operator:e[2],value:(null==(t=e[3])?void 0:t.trim())||"1"}}},...[{type:"if",regex:/^\{if\s+(.+?)\}/,process:e=>({condition:e[1].trim()})},{type:"elseif",regex:/^\{elseif\s+(.+?)\}/,process:e=>({condition:e[1].trim()})},{type:"else",regex:/^\{else\}/},{type:"endif",regex:/^\{\/if\}/}],{type:"ignore_block",regex:/^\{ignore\}([\s\S]*?)\{\/ignore\}/,process:e=>({content:e[1]})},...[{type:"set",regex:/^\{set\s+\$(\w+)\s*=\s*(\{[^}]*\}|\[[^}]*\])\}/,process:e=>({variable:e[1],value:e[2]})},{type:"set",regex:/^\{set\s+\$(\w+)\s*=\s*(['"])(.*?)\2\}/,process:e=>({variable:e[1],value:e[3]})},{type:"set",regex:/^\{set\s+\$(\w+)\s*=\s*([^}\s][^}]*)\}/,process:e=>({variable:e[1],value:e[2].trim()})},{type:"add",regex:/^\{add\s+\$(\w+)\s*\+\+\}/,process:e=>({variable:e[1]})},{type:"var",regex:/^\{var\s+\$(\w+)\s*=\s*(['"])(.*?)\2\}/,process:e=>({variable:e[1],value:e[3]})}],...[{type:"unset",regex:/^\{unset\s+\$(\w+)\}/,process:e=>({variable:e[1]})},{type:"comment",regex:/^\{\*\s*([\s\S]*?)\s*\*\}/}],...[{type:"cycle",regex:/^\{cycle\s+(.+?)\}/,process:e=>({values:e[1]})}],...[{type:"filter",regex:/^\{filter\s+(.+?)\}/,process:e=>({filter:e[1].trim()})},{type:"endfilter",regex:/^\{\/filter\}/},{type:"raw",regex:/^\{raw\}/},{type:"endraw",regex:/^\{\/raw\}/},{type:"autoescape",regex:/^\{autoescape\}/},{type:"endautoescape",regex:/^\{\/autoescape\}/}],...[{type:"macro",regex:/^\{macro\s+(\w+)(?:\s*\((.*?)\))?\}/,process(e){const t=e[2]?e[2].split(",").map(e=>e.trim()):[];return{name:e[1],args:t}}},{type:"endmacro",regex:/^\{\/macro\}/},{type:"import",regex:/^\{import\s+(['"])(.*?)\1\s+as\s+(\w+)\}/,process:e=>({file:e[2],alias:e[3]})}],{type:"output",regex:/^\{output\s+name\s*=\s*(['"])(.*?)\1\s*\}/,process:e=>({name:e[2],filters:[]})},{type:"output",regex:/^\{output\s+(['"])(.*?)\1\s*\}/,process:e=>({name:e[2],filters:[]})},{type:"output",regex:/^\{output\s+([^\s}]+)\s*\}/,process:e=>({name:e[1],filters:[]})},{type:"output",regex:/^\{output\s+(\$?[^}]+)\}/,process:e=>({name:e[1].trim(),filters:[]})},{type:"output",regex:/^\{\$(.+?)\}/,process:e=>{const t=e[1].trim().split("|").map(e=>e.trim());return{name:`$${t[0]}`,filters:t.slice(1)}}},{type:"output",regex:/^\{([^$].+?)\}/,process:e=>({name:e[1].trim(),filters:[]})}];function s(e){const t=[];let s=0;for(;s<e.length;){let n=!1;if(e.slice(s).startsWith("{ignore}")){let r=1,o=s+8;for(;o<e.length;)if(e.length-o>=8&&e.startsWith("{ignore}",o))r++,o+=8;else if(e.length-o>=9&&e.startsWith("{/ignore}",o)){if(r--,o+=9,0===r){const r=e.slice(s+8,o-9);t.push({type:"text",value:r}),s=o,n=!0;break}}else o++;n||(t.push({type:"text",value:"{ignore}"}),s+=8);continue}if("{"!==e[s]){const r=e.indexOf("{",s);if(-1===r){t.push({type:"text",value:e.slice(s)});break}r>s&&t.push({type:"text",value:e.slice(s,r)}),s=r}for(const o of r){const r=e.slice(s).match(o.regex);if(r){const e={type:o.type,value:r[0]};if("comment"===o.type){s+=r[0].length,n=!0;break}o.process&&Object.assign(e,o.process(r)),t.push(e),s+=r[0].length,n=!0;break}}if(!n){const t=e.slice(s,s+30).replace(/\n/g,"↵");console.warn(`Skip unknown tag at ${s}: "${t}"`),s++}}return t}function n(e,t){const r={type:"if",condition:e[t].condition,body:[],elseIfs:[],elseBody:[]};let s=t+1,n=0;const o=[],a=[],i=[];let l=null,u=!1;for(;s<e.length;){const t=e[s];if("if"===t.type&&n++,"endif"===t.type){if(0===n)break;n--}if(n>0)l||u?l?l.tokens.push(t):u&&i.push(t):o.push(t),s++;else if("elseif"!==t.type)if("else"!==t.type){if("endif"===t.type)break;l||u?l?l.tokens.push(t):u&&i.push(t):o.push(t),s++}else l=null,u=!0,s++;else l||u?l?l.tokens.push(t):u&&i.push(t):(l={condition:t.condition,tokens:[]},a.push(l)),s++}return r.body=c(o),r.elseIfs=a.map(e=>({condition:e.condition,body:c(e.tokens)})),r.elseBody=c(i),{node:r,nextIndex:s+1}}function o(e,t){const r=e[t],s={type:"for",key:r.key||null,item:r.item,collection:r.collection,reverse:Boolean(r.reverse),body:[],elseBody:[]};let n=t+1,o=0,a=!1;const i=[],l=[];for(;n<e.length;){const t=e[n];if("for"!==t.type&&"foreach"!==t.type||o++,"endfor"===t.type||"endforeach"===t.type){if(!(o>0))break;o--}"foreachelse"!==t.type||0!==o?(a?l.push(t):i.push(t),n++):(a=!0,n++)}if(n>=e.length)throw new Error("Unclosed for loop: expected {/for}");return s.body=c(i),s.elseBody=c(l),{node:s,nextIndex:n+1}}function a(e,t){const r={type:"switch",value:e[t].value,cases:[],defaultBody:[]};let s=t+1,n=0,o=null,a=!1;for(;s<e.length;){const t=e[s];if("switch"===t.type&&n++,"endswitch"===t.type){if(n>0){n--,o&&o.body.push(t),s++;continue}return{node:r,nextIndex:s+1}}if(n>0)o&&o.body.push(t),s++;else if("case"!==t.type)if("default"!==t.type)o?o.body.push(t):a?r.defaultBody.push(t):r.cases.length>0&&r.cases[r.cases.length-1].body.push(t),s++;else{if(a)throw new Error("Duplicate {default} in switch");a=!0,o=null,s++}else o={value:t.value,body:[]},r.cases.push(o),s++}throw new Error("Unclosed switch: expected {/switch}")}function c(e){const t=[];let r=0;for(;r<e.length;){const s=e[r];if("block_open"===s.type){const n=s.name;r++;const o=[];let a=0;for(;r<e.length;){const t=e[r];if("block_open"===t.type&&a++,"block_close"===t.type){if(0===a)break;a--}o.push(t),r++}const i=c(o);t.push({type:"block",name:n,body:i}),r++;continue}if("extends"!==s.type)if("include"!==s.type)if(["set","var","add"].includes(s.type))t.push({...s}),r++;else{if("if"===s.type){const{node:s,nextIndex:o}=n(e,r);t.push(s),r=o;continue}if("for"===s.type||"foreach"===s.type){const{node:s,nextIndex:n}=o(e,r);t.push(s),r=n;continue}if("switch"===s.type){const{node:s,nextIndex:n}=a(e,r);t.push(s),r=n;continue}if("output"===s.type){const e=s.value.match(/^\{\$(.+)\}$/);if(!e){t.push({type:"text",value:s.value}),r++;continue}const n=e[1].trim().split("|"),o=n[0],a=n.slice(1);t.push({type:"output",name:`$${o}`,filters:a}),r++;continue}["elseif","else","endif","endfor","endforeach","endswitch"].includes(s.type)||t.push({...s}),r++}else t.push({...s}),r++;else t.push({...s}),r++}return t}function i(e){if("true"===(e=e.trim()))return!0;if("false"===e)return!1;if("null"===e)return null;if("undefined"!==e){if(!isNaN(+e)&&!e.includes(" "))return+e;if(/^["'](.*)["']$/.test(e))return e.slice(1,-1);if(e.startsWith("[")&&e.endsWith("]"))try{return e.slice(1,-1).split(",").map(e=>e.trim()).map(i)}catch{}if(e.startsWith("{")&&e.endsWith("}"))try{return JSON.parse(e.replace(/(\w+):/g,'"$1":').replace(/'/g,'"'))}catch{}return e}}function l(e,t,r){return(...s)=>{const n=s[0];let o=!1;switch(t){case"array":o=Array.isArray(n);break;case"string":o="string"==typeof n;break;case"object":o=n&&"object"==typeof n&&!Array.isArray(n)}return o||console.warn(`[Fenom] filter '${e}' should be used with ${t}, but got ${typeof n}`),r(...s)}}function u(e,t){const r=e.split(".").map(e=>e.trim());let s=t;for(const n of r){if(null==s||"object"!=typeof s)return;s=s[n]}return s}function p(e,t,r,s){let n=e;for(const a of t){const[e,...t]=a.split(":").map(e=>e.trim()),c=s[e];if("function"==typeof c){const e=t.map(e=>/^["'].*["']$/.test(e)?e.slice(1,-1):isNaN(+e)?e.startsWith("$")?u(e.slice(1),r)??"":e:+e);try{n=c(n,...e)}catch(o){n=""}}}return n}function f(e){const t=function(e){const t=[],r=/(\s+|[$a-zA-Z_]\w*(?:\.\w+)*|"(?:[^"\\]|\\.)*"|'(?:[^'\\]|\\.)*'|\d+(?:\.\d+)?|[-+*/%<>=!&|?:(){}[\]~]+|[\w-]+:)/g;let s;const n=e=>["+","-","*","/","%","==","!=","<","<=",">",">=","&&","||","!","(",")","?",":","~"].includes(e);for(;null!==(s=r.exec(e));){const e=s[0].trim();if(e)if(n(e))t.push({type:"op",value:e});else if("|"===e)t.push({type:"filter",value:e});else if(e.startsWith("$"))t.push({type:"var",value:e});else if(/^["']/.test(e)){const r=e.slice(1,-1).replace(/\\(.)/g,"$1");t.push({type:"str",value:r})}else isNaN(+e)?t.push({type:"str",value:e}):t.push({type:"num",value:e})}return t}(e);let r=0;function s(){const e=o(()=>o(()=>o(()=>o(()=>o(()=>n(),["*","/","%"]),["+","-","~"]),["<","<=",">",">="]),["==","!="]),["||","&&"]);if(r<t.length&&"?"===t[r].value){r++;const n=s();r<t.length&&":"===t[r].value&&r++;return{type:"conditional",test:e,consequent:n,alternate:s()}}return e}function n(){if(r<t.length&&["!","+","-"].includes(t[r].value)){const e=t[r].value;return r++,{type:"unary",operator:e,argument:n()}}return function(){const e=t[r];if(!e)throw new Error("Unexpected end of expression");if("num"===e.type)return r++,{type:"literal",value:+e.value};if("str"===e.type)return r++,{type:"literal",value:e.value};if("var"===e.type)return r++,{type:"variable",path:e.value.slice(1)};if("("===e.value){r++;const e=s();if(r>=t.length||")"!==t[r].value)throw new Error("Expected )");return r++,e}throw new Error(`Unexpected token: ${e.value}`)}()}function o(e,s){let n=e();for(;r<t.length&&s.includes(t[r].value);){const s=t[r].value;r++;n={type:"binary",operator:s,left:n,right:e()}}return n}return s()}function y(e,t,r){switch(e.type){case"literal":return e.value;case"variable":return u(e.path,t)??"";case"unary":const s=y(e.argument,t,r);switch(e.operator){case"!":return!s;case"+":return+s;case"-":return-s}break;case"binary":{const s=y(e.left,t,r),n=y(e.right,t,r);switch(e.operator){case"+":return s+n;case"-":return s-n;case"*":return s*n;case"/":return s/n;case"%":return s%n;case"==":return s==n;case"!=":return s!=n;case"<":return s<n;case"<=":return s<=n;case">":return s>n;case">=":return s>=n;case"&&":return s&&n;case"||":return s||n;case"~":return String(s)+String(n)}break}case"conditional":const n=y(e.test,t,r);return y(n?e.consequent:e.alternate,t,r);case"filter":{const s=y(e.expression,t,r),n=e.args.map(e=>y(e,t,r)),o=r[e.filter];return"function"==typeof o?o(s,...n):s}}return""}function g(e,t,r,s){var n,o,a,c,l,d;switch(e.type){case"ignore_block":t(e.content||"");break;case"comment":case"extends":case"include":break;case"text":t(e.value);break;case"output":if(/[+\-*/%<>!=&|?:]/.test(e.name))try{let n=y(f(e.name),r,s);n=p(n,e.filters,r,s),t(String(n))}catch(h){console.warn(`Eval error: ${e.name}`,h),t("")}else{let n=u((d=e.name).startsWith("$")?d.slice(1):d,r)??"";n=p(n,e.filters,r,s),t(String(n))}break;case"set":{const{variable:t,value:n}=e;if(/[+\-*/%~]/.test(n))try{const e=f(n);r[t]=y(e,r,s)}catch(h){r[t]=""}else if(n.startsWith("$")){const e=n.slice(1);r[t]=u(e,r)??""}else r[t]=i(n);break}case"var":void 0===r[e.variable]&&(r[e.variable]=i(e.value));break;case"add":r[e.variable]=(r[e.variable]||0)+1;break;case"if":{let c=!1;try{c=!!y(f(e.condition),r,s)}catch(h){console.warn(`Condition error: ${e.condition}`,h),c=!1}if(c)for(const n of e.body)g(n,t,r,s);else if(null==(n=e.elseIfs)?void 0:n.length){let n=!1;for(const o of e.elseIfs){let e=!1;try{e=!!y(f(o.condition),r,s)}catch(h){console.warn(`Condition error: ${o.condition}`,h),e=!1}if(e){for(const e of o.body)g(e,t,r,s);n=!0;break}}if(!n&&(null==(o=e.elseBody)?void 0:o.length))for(const o of e.elseBody)g(o,t,r,s)}else if(null==(a=e.elseBody)?void 0:a.length)for(const n of e.elseBody)g(n,t,r,s);break}case"for":{const n=u(e.collection.slice(1),r);if(Array.isArray(n)&&n.length>0){const o=e.reverse??!1?[...n].reverse().keys():n.keys();for(const a of o){const o=n[a];r[e.item]=o,e.key&&(r[e.key]=a);for(const n of e.body)g(n,t,r,s)}}else if(null==(c=e.elseBody)?void 0:c.length)for(const o of e.elseBody)g(o,t,r,s);break}case"switch":{const n=r[e.value.slice(1)];let o=!1;for(const a of e.cases)if(a.value===n){for(const e of a.body)g(e,t,r,s);o=!0;break}if(!o&&(null==(l=e.defaultBody)?void 0:l.length))for(const a of e.defaultBody)g(a,t,r,s);break}case"operator":{const{variable:s,operator:n,value:o}=e,a=u(s,r),c="number"==typeof a?a:+a||0;let i,l;if(/^[\d.]+$/.test(o))i=parseFloat(o);else{const e=u(o,r);i="number"==typeof e?e:+e||0}switch(n){case"++":l=c,r[s]=c+1;break;case"--":l=c,r[s]=c-1;break;case"+=":l=c,r[s]=c+i;break;case"-=":l=c,r[s]=c-i;break;case"*=":l=c,r[s]=c*i;break;case"/=":l=c,r[s]=c/i;break;case"%=":l=c,r[s]=c%i;break;default:console.warn(`Unknown operator: ${n}`),l=0}t(String(l));break}case"block":t(`{block "${e.name}"}`);break;default:console.warn(`Unknown node type: ${e.type}`)}}function d(e,t){const r={};let n=null;for(const s of e)"extends"===s.type?n=s.file:"block"===s.type&&(r[s.name]=s.body);return n?async function(e,o){try{const a=await t(n),i=c(s(a)),l={};for(const e of i)"block"===e.type&&(l[e.name]=e.body);const u={...l,...r},p={};e.block=async r=>{if(void 0!==p[r])return p[r];const n=u[r];if(!n)return p[r]="","";let a="";const i={...e};for(const e of n)if("include"===e.type)try{const r=await t(e.file),n=c(s(r)),l={...i};if(e.params)for(const[t,s]of Object.entries(e.params))"string"==typeof s&&s.startsWith("$")?l[t]=i[s.slice(1)]:l[t]=s;for(const e of n)g(e,e=>a+=e,l,o)}catch{a+=`[Include error: ${e.file}]`}else g(e,e=>a+=e,i,o);return p[r]=a,a};let f="";for(const r of i)if("block"===r.type)f+=await e.block(r.name);else if("include"===r.type)try{const n=await t(r.file),a=c(s(n)),i={...e};if(r.params)for(const[t,s]of Object.entries(r.params))"string"==typeof s&&s.startsWith("$")?i[t]=e[s.slice(1)]:i[t]=s;for(const e of a)g(e,e=>f+=e,i,o)}catch{f+=`[Include error: ${r.file}]`}else g(r,e=>f+=e,e,o);return f}catch(a){return`[Render error: ${a.message}]`}}:async function(r,n){let o="";for(const a of e)if("include"===a.type)try{const e=await t(a.file),i=c(s(e)),l={...r};if(a.params)for(const[t,s]of Object.entries(a.params))"string"==typeof s&&s.startsWith("$")?l[t]=r[s.slice(1)]:l[t]=s;for(const t of i)g(t,e=>o+=e,l,n)}catch{o+=`[Include error: ${a.file}]`}else g(a,e=>o+=e,r,n);return o}}function h(r){return async function(s){const n=e(r,s);if(!n.endsWith(".tpl"))throw new Error(`Template path must end with .tpl: ${s}`);try{return await t(n,"utf-8")}catch(o){if("ENOENT"===o.code)throw new Error(`Template not found: ${n}`);throw o}}}const b={upper:e=>String(e).toUpperCase(),lower:e=>String(e).toLowerCase(),capitalize:e=>{const t=String(e).trim();return 0===t.length?"":t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()},ucfirst:e=>b.capitalize(e),ucwords:e=>String(e).trim().replace(/\b\w/g,e=>e.toUpperCase()),lcfirst:e=>{const t=String(e).trim();return 0===t.length?"":t.charAt(0).toLowerCase()+t.slice(1)},trim:e=>String(e).trim(),ltrim:e=>String(e).replace(/^\s+/,""),rtrim:e=>String(e).replace(/\s+$/,""),nl2br:e=>String(e).replace(/\n/g,"<br>"),replace:(e,t,r)=>String(e).split(String(t)).join(String(r)),substr:l("substr","string",(e,t,r)=>{const s=String(e);return void 0===r?s.slice(t):s.slice(t,t+r)}),urlencode:e=>encodeURIComponent(String(e)),urldecode:e=>decodeURIComponent(String(e)),escape:l("escape","string",e=>String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")),e:e=>b.escape(e),first:l("first","array",e=>Array.isArray(e)?e[0]:e&&"object"==typeof e?Object.values(e)[0]:""),last:l("last","array",e=>{if(Array.isArray(e))return e[e.length-1];if(e&&"object"==typeof e){const t=Object.values(e);return t[t.length-1]}return""}),join:l("join","array",(e,t=",")=>Array.isArray(e)?e.join(t):e&&"object"==typeof e?Object.values(e).join(t):String(e)),reverse:l("reverse","array",e=>Array.isArray(e)?[...e].reverse():e),sort:l("sort","array",e=>Array.isArray(e)?[...e].sort():e),ksort:l("ksort","object",e=>{if(e&&"object"==typeof e){const t={};return Object.keys(e).sort().forEach(r=>{t[r]=e[r]}),t}return e}),unique:l("unique","array",e=>Array.isArray(e)?[...new Set(e)]:e),shuffle:l("shuffle","array",e=>{if(!Array.isArray(e))return e;const t=[...e];for(let r=t.length-1;r>0;r--){const e=Math.floor(Math.random()*(r+1));[t[r],t[e]]=[t[e],t[r]]}return t}),slice:(e,t,r)=>Array.isArray(e)||"string"==typeof e?void 0===r?e.slice(t):e.slice(t,t+r):e,merge:(e,t)=>Array.isArray(e)&&Array.isArray(t)?[...e,...t]:e,batch:(e,t)=>{if(!Array.isArray(e))return e;const r=[];for(let s=0;s<e.length;s+=t)r.push(e.slice(s,s+t));return r},keys:e=>e&&"object"==typeof e?Object.keys(e):[],values:e=>e&&"object"==typeof e?Object.values(e):[],length:e=>Array.isArray(e)?e.length:e&&"object"==typeof e?Object.keys(e).length:String(e).length,number_format:(e,t=0,r=".",s=",")=>{const n=Number(e);return isNaN(n)?"":n.toLocaleString("en-US",{minimumFractionDigits:t,maximumFractionDigits:t,useGrouping:!0}).replace(/,/g,s).replace(/\./g,r)},abs:e=>Math.abs(Number(e)||0),round:(e,t=0)=>{const r=10**t;return Math.round((Number(e)||0)*r)/r},json_encode:e=>JSON.stringify(e),json_decode:e=>{try{return JSON.parse(String(e))}catch{return null}},date:(e,t="d.m.Y")=>{const r=Number(e),s=new Date(isNaN(r)?e:1e3*r);if(isNaN(s.getTime()))return console.warn(`[Fenom] filter 'date' received invalid timestamp: ${e}`),"";const n=e=>e.toString().padStart(2,"0");return t.replace(/d/g,n(s.getDate())).replace(/m/g,n(s.getMonth()+1)).replace(/Y/g,s.getFullYear().toString()).replace(/H/g,n(s.getHours())).replace(/i/g,n(s.getMinutes())).replace(/s/g,n(s.getSeconds()))},default:(e,t)=>null==e||""===e||"object"==typeof e&&0===Object.keys(e).length?t:e,raw:e=>e,var_dump:e=>`<pre>${JSON.stringify(e,null,2)}</pre>`,print_r:e=>`<pre>${e instanceof Object?JSON.stringify(e,null,2):String(e)}</pre>`};async function m(e,t={},r){const{root:n="./src/",loader:o,minify:a=!1}=r||{},i=o||h(n);try{const r=s(e),n=d(c(r),i),o=await n(t,b);return a?function(e){return e.replace(/>\s+</g,"><").replace(/\s{2,}/g," ").replace(/(<!--.*?-->)\s+/g,"$1").trim()}(o):o}catch(l){return console.error("Template error:",l),`<span style='color:red'>[Ошибка шаблона: ${l.message}]</span>`}}export{m as FenomJs,d as compile,h as createAsyncLoader,c as parse,s as tokenize};
