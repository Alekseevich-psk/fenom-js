Что мы получили
✅ Все теги разделены по группам
✅ Легко добавлять новые
✅ Поддержка filters прямо в {$var|upper|escape}
✅ process() — гибкая обработка аргументов
✅ Комментарии {_ ... _} — не попадают в AST

Следующие шаги
Теперь, когда токенизатор масштабируемый, можно:

🧱 Писать парсер AST, который:

Группирует if / else / endif
Собирает block и extends
Обрабатывает вложенность
🧮 Реализовать встроенные фильтры (upper, lower, escape и т.д.)

⚙️ Сделать компилятор, который:

Генерирует безопасный JS
Поддерживает context.$var
Экранирует по умолчанию


<h1>🚀 Расширенная демонстрация возможностей Fenom</h1>

{set $name = "Анна"}
{set $age = 28}
{set $role = "admin"}
{set $items = ['a', 'b', 'c']}
{set $value1 = 5}  {# 101 в двоичной #}
{set $value2 = 3}  {# 011 в двоичной #}
{set $score1 = 85}
{set $score2 = 92}
{set $arr1 = [3, 1, 4]}
{set $arr2 = [1, 5, 9]}

{* ————————————————————————————————
   1. КОНКАТЕНАЦИЯ СТРОК: ~
   ———————————————————————————————— *}
<section>
    <h2>🔤 Конкатенация строк (~)</h2>
    <p>{$name ~ " — " ~ "пользователь уровня " ~ $age}</p>
    <p>{"Привет" ~ " " ~ "мир" ~ "!"}</p>
    <p>{"Итого: " ~ ($score1 + $score2)}</p>
</section>

{* ————————————————————————————————
   2. МЕТА-ПЕРЕМЕННАЯ $iteration
   ———————————————————————————————— *}
<section>
    <h2>🔄 $iteration в циклах</h2>
    {foreach $items as $item}
        <div class="item">
            <strong>[#{$iteration.number}] {$item|upper}</strong>
            <ul>
                <li>Индекс: {$iteration.index}</li>
                <li>Чётный: {if $iteration.isEven}Да{else}Нет{/if}</li>
                <li>Первый: {$iteration.isFirst ? '✅' : '❌'}</li>
                <li>Последний: {$iteration.isLast ? '✅' : '❌'}</li>
                <li>Остаток: {$iteration.index % 3}</li>
            </ul>
        </div>
    {/foreach}

    <p>Всего элементов: {$iteration.total}</p>
</section>

{* ————————————————————————————————
   3. CAPTURE — сбор вывода в переменную
   ———————————————————————————————— *}
{capture $welcome}
    <div class="welcome-box">
        <h3>Добро пожаловать, {$name}!</h3>
        <p>Сегодня {time()|date:'d.m.Y'}</p>
        {if $age >= 18}
            <p>✅ Совершеннолетний</p>
        {/if}
    </div>
{/capture}

<section>
    <h2>📦 capture — сбор вывода</h2>
    {$welcome|escape} {# Безопасный вывод #}
</section>

{* ————————————————————————————————
   4. SWITCH — выбор по значению
   ———————————————————————————————— *}
<section>
    <h2>🔀 switch / case</h2>
    {switch $role}
        {case "admin"}
            <p>🔑 Администратор: полный доступ</p>
        {case "moderator"}
            <p>🛡️ Модератор: ограниченный доступ</p>
        {case "user"}
            <p>👤 Пользователь: только чтение</p>
        {default}
            <p>❓ Неизвестная роль</p>
    {/switch}
</section>

{* ————————————————————————————————
   5. IGNORE — игнорирование блока
   ———————————————————————————————— *}
<section>
    <h2>🙈 ignore — игнор кода</h2>
    {ignore}
        <p>Этот текст <b>не будет отображён</b>.</p>
        {set $secret = "Никто не узнает"}
        {$secret}
        {if true}{break}{/if} {* даже break не сломает *}
    {/ignore}
    <p>Игнорированный блок пропущен.</p>
</section>

{* ————————————————————————————————
   6. БИТОВЫЕ И ПРОЧИЕ ОПЕРАТОРЫ
   ———————————————————————————————— *}
<section>
    <h2>⚙️ Битовые и сравнительные операторы</h2>
    <ul>
        <li><strong>Побитовое ИЛИ (|):</strong> {$value1 | $value2} → 7 (101 | 011 = 111)</li>
        <li><strong>Побитовое И (&):</strong> {$value1 & $value2} → 1 (101 & 011 = 001)</li>
        <li><strong>Побитовое Исключающее ИЛИ (^):</strong> {$value1 ^ $value2} → 6 (101 ^ 011 = 110)</li>
        <li><strong>Пространственный (<=></strong> {$score1 <=> $score2} → -1 (меньше)</li>
        <li><strong>Пространственный:</strong> {$score2 <=> $score1} → 1 (больше)</li>
        <li><strong>Равенство:</strong> {$score1 <=> $score1} → 0 (равно)</li>
        <li><strong>Сложение:</strong> {$value1 + $value2}</li>
        <li><strong>Конкатенация в выражении:</strong> {'Результат: ' ~ ($value1 | $value2)}</li>
    </ul>
</section>

{* ————————————————————————————————
   7. МАССИВЫ И ФИЛЬТРЫ (для контекста)
   ———————————————————————————————— *}
<section>
    <h2>🧩 Массивы и фильтры</h2>
    <p>Объединение: {$arr1|merge:$arr2|join:', '}</p>
    <p>Сортировка: {$arr1|sort|join:', '}</p>
    <p>Первый: {$arr1|first}</p>
    <p>Последний: {$arr1|last}</p>
</section>

{* ————————————————————————————————
   8. ВЫЗОВ PHP-ФУНКЦИЙ
   ———————————————————————————————— *}
<section>
    <h2>🔧 Вызов PHP-функций</h2>
    <p>MD5: {md5('fenom')}</p>
    <p>Длина строки: {strlen('hello world')}</p>
    <p>Минимум: {min(10, 20, 5)}</p>
    <p>Текущее время: {time()|date:'H:i:s'}</p>
</section>
